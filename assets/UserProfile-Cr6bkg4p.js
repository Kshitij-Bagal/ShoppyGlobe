import{r as o,u as k,j as e,L as A,s as P}from"./index-D3Q5HvY8.js";const T=()=>{var f,y,N,C,v;const[s,p]=o.useState(null),[E,S]=o.useState(!0),[m,x]=o.useState(null),[i,j]=o.useState(!1),[t,c]=o.useState({firstName:"",lastName:"",email:"",username:"",age:"",phone:"",gender:"",address:{street:"",city:"",state:"",postalCode:"",country:""}}),g=k(),d=localStorage.getItem("token");if(!d){window.location.href="/login";return}o.useEffect(()=>{(async()=>{try{const a=await fetch("https://shoppyglobe-server.onrender.com/api/users/profile",{method:"GET",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}}),r=await a.json();if(!a.ok)throw new Error("Failed to fetch user profile");p(r),localStorage.setItem("userRole",r.role),g(P(d))}catch(a){console.error("Error fetching user data:",a),x(a.message)}finally{S(!1)}})()},[d,g]);const u=()=>{j(!i),!i&&s&&c({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",username:s.username||"",age:s.age||"",phone:s.phone||"",gender:s.gender||"",address:s.address||{street:"",city:"",state:"",postalCode:"",country:""}})},n=l=>{const{name:a,value:r}=l.target;if(a.includes("address")){const h=a.split(".")[1];c(b=>({...b,address:{...b.address,[h]:r}}))}else c(h=>({...h,[a]:r}))},w=async l=>{l.preventDefault();try{const a=await fetch("https://shoppyglobe-server.onrender.com/api/users/profile",{method:"PUT",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await a.json();if(!a.ok)throw new Error("Failed to update profile");p(r),j(!1)}catch(a){console.error("Error updating user data:",a),x(a.message)}};if(E)return e.jsx("div",{className:"loading-spinner",children:"Loading..."});if(m)return e.jsxs("div",{className:"error-message",children:["Error: ",m]});const U=(s==null?void 0:s.role)==="admin";return e.jsxs("div",{className:"user-profile",children:[e.jsxs("h2",{className:"profile-heading",children:["Welcome, ",s==null?void 0:s.firstName," ",s==null?void 0:s.lastName]}),e.jsxs("div",{className:"profile-details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",(s==null?void 0:s.email)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",(s==null?void 0:s.username)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",(s==null?void 0:s.phone)||"N/A"]}),i?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",name:"firstName",placeholder:"First Name",value:t.firstName,onChange:n}),e.jsx("br",{}),e.jsx("input",{type:"text",name:"lastName",placeholder:"Last Name",value:t.lastName,onChange:n}),e.jsx("br",{}),e.jsx("input",{type:"email",name:"email",placeholder:"Email",value:t.email,onChange:n}),e.jsx("br",{}),e.jsx("input",{type:"text",name:"username",placeholder:"Username",value:t.username,onChange:n}),e.jsx("br",{}),e.jsx("input",{type:"number",name:"age",placeholder:"Age",value:t.age,onChange:n}),e.jsx("br",{}),e.jsx("input",{type:"number",name:"phone",placeholder:"Phone",value:t.phone,onChange:n}),e.jsx("br",{}),e.jsx("input",{type:"text",name:"gender",placeholder:"Gender",value:t.gender,onChange:n}),e.jsx("br",{}),e.jsxs("div",{className:"profile-address",children:[e.jsx("h3",{children:"Address:"}),e.jsx("input",{type:"text",name:"address.street",placeholder:"Street",value:t.address.street,onChange:n}),e.jsx("br",{}),e.jsx("input",{type:"text",name:"address.city",placeholder:"City",value:t.address.city,onChange:n}),e.jsx("br",{}),e.jsx("input",{type:"text",name:"address.state",placeholder:"State",value:t.address.state,onChange:n}),e.jsx("br",{}),e.jsx("input",{type:"text",name:"address.postalCode",placeholder:"Postal Code",value:t.address.postalCode,onChange:n}),e.jsx("br",{}),e.jsx("input",{type:"text",name:"address.country",placeholder:"Country",value:t.address.country,onChange:n})]}),e.jsx("br",{}),e.jsx("button",{onClick:w,children:"Save"}),e.jsx("button",{onClick:u,children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",(s==null?void 0:s.age)||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gender:"})," ",(s==null?void 0:s.gender)||"N/A"]}),e.jsxs("div",{className:"profile-address",children:[e.jsx("h3",{children:"Address:"}),e.jsxs("p",{children:[((f=s==null?void 0:s.address)==null?void 0:f.street)||"N/A",", ",((y=s==null?void 0:s.address)==null?void 0:y.city)||"N/A",",",((N=s==null?void 0:s.address)==null?void 0:N.state)||"N/A",", ",((C=s==null?void 0:s.address)==null?void 0:C.postalCode)||"N/A",",",((v=s==null?void 0:s.address)==null?void 0:v.country)||"N/A"]})]}),e.jsx("button",{onClick:u,children:"Edit Profile"})]}),U&&e.jsxs("div",{className:"admin-controls",children:[e.jsx("h3",{children:"Admin Panel"}),e.jsx(A,{to:"/adminproducts",children:e.jsx("button",{children:"Update Product Database"})}),e.jsx(A,{to:"/adminusers",children:e.jsx("button",{children:"Manage User Accounts"})})]})]})]})};export{T as default};
