import{k as P,u as E,d as D,r as m,l as k,j as e,m as w}from"./index-BsOYX6uE.js";const O=()=>{const N=P(),{cart:p,total:h}=N.state||{cart:[],total:0},u=E(),o=D(r=>r.user.data),[x,y]=m.useState(null),[s,j]=m.useState({name:"",cardNumber:"1234567891011121",expiry:"12/24",cvv:"123",street:"",city:"",state:"",postalCode:""}),[t,f]=m.useState({name:!1,cardNumber:!1,expiry:!1,cvv:!1,street:!1,city:!1,state:!1,postalCode:!1});m.useEffect(()=>{o?j(r=>{var a,c,d,n;return{...r,street:((a=o.address)==null?void 0:a.street)||"",city:((c=o.address)==null?void 0:c.city)||"",state:((d=o.address)==null?void 0:d.state)||"",postalCode:((n=o.address)==null?void 0:n.postalCode)||""}}):u(k())},[u,o]);const C=async()=>{try{const r=await fetch("https://shoppyglobe-server.onrender.com/api/cart/clear",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});r.ok?(console.log("Cart cleared successfully"),u(w())):console.error("Failed to clear cart:",await r.json())}catch(r){console.error("Error clearing cart:",r)}},b=async(r,a,c,d)=>{try{const n={userId:r,cart:a.map(i=>({title:i.title,thumbnail:i.thumbnail,productId:i._id,quantity:i.quantity,price:i.price})),shippingAddress:c,total:d,paymentStatus:"success"},g=await fetch("https://shoppyglobe-server.onrender.com/api/orders",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(n)}),v=await g.json();g.status===201?(console.log("Order created successfully:",v),await C()):console.error("Error:",v)}catch(n){console.error("Error:",n)}},l=r=>{const{name:a,value:c}=r.target;j({...s,[a]:c})},S=()=>{const r={};return r.name=s.name.trim()==="",r.cardNumber=s.cardNumber.length!==16,r.expiry=!/\d{2}\/\d{2}/.test(s.expiry),r.cvv=s.cvv.length!==3,r.street=s.street.trim()==="",r.city=s.city.trim()==="",r.state=s.state.trim()==="",r.postalCode=s.postalCode.trim()==="",f(r),Object.values(r).some(a=>a)},q=r=>{if(r.preventDefault(),S())y("failure");else{y("success");const a={street:s.street,city:s.city,state:s.state,postalCode:s.postalCode};b(o._id,p,a,h)}};return e.jsxs("div",{className:"payment-portal",children:[e.jsxs("div",{className:"product-summary",children:[e.jsx("h2",{children:"Demo Payment Portal"}),e.jsx("h3",{children:"Order Summary"}),e.jsx("ul",{children:p.map(r=>e.jsxs("li",{children:[r.title," x ",r.quantity," - $",r.price*r.quantity]},r._id))}),e.jsxs("h4",{children:["Total: $",h.toFixed(2)]})]}),e.jsxs("form",{onSubmit:q,className:"payment-form",children:[e.jsx("h3",{children:"Payment Details"}),e.jsx("label",{children:"Name on Card"}),e.jsx("input",{type:"text",name:"name",placeholder:"John Doe",required:!0,onChange:l,className:t.name?"error":""}),t.name&&e.jsx("small",{className:"error-message",children:"Name is required"}),e.jsx("label",{children:"Card Number"}),e.jsx("input",{type:"text",name:"cardNumber",placeholder:"1234567891011121",maxLength:"16",required:!0,onChange:l,className:t.cardNumber?"error":"",value:s.cardNumber}),t.cardNumber&&e.jsx("small",{className:"error-message",children:"Card number must be 16 digits"}),e.jsxs("div",{className:"card-info",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Expiry Date"}),e.jsx("br",{}),e.jsx("input",{type:"text",name:"expiry",placeholder:"MM/YY",maxLength:"5",required:!0,onChange:l,className:t.expiry?"error":"",value:s.expiry}),t.expiry&&e.jsx("small",{className:"error-message",children:"Invalid expiry format"})]}),e.jsxs("div",{children:[e.jsx("label",{children:"CVV"}),e.jsx("br",{}),e.jsx("input",{type:"text",name:"cvv",placeholder:"123",maxLength:"3",required:!0,onChange:l,className:t.cvv?"error":"",value:s.cvv}),t.cvv&&e.jsx("small",{className:"error-message",children:"CVV must be 3 digits"})]})]}),e.jsx("h3",{children:"Shipping Address"}),e.jsx("label",{children:"Street"}),e.jsx("input",{type:"text",name:"street",value:s.street,onChange:l,required:!0,className:t.street?"error":""}),t.street&&e.jsx("small",{className:"error-message",children:"Street is required"}),e.jsx("label",{children:"City"}),e.jsx("input",{type:"text",name:"city",value:s.city,onChange:l,required:!0,className:t.city?"error":""}),t.city&&e.jsx("small",{className:"error-message",children:"City is required"}),e.jsx("label",{children:"State"}),e.jsx("input",{type:"text",name:"state",value:s.state,onChange:l,required:!0,className:t.state?"error":""}),t.state&&e.jsx("small",{className:"error-message",children:"State is required"}),e.jsx("label",{children:"Postal Code"}),e.jsx("input",{type:"text",name:"postalCode",value:s.postalCode,onChange:l,required:!0,className:t.postalCode?"error":""}),t.postalCode&&e.jsx("small",{className:"error-message",children:"Postal code is required"}),e.jsx("button",{type:"submit",children:"Pay Now"})]}),x==="success"&&e.jsx("div",{className:"payment-success",children:"✅ Payment Successful! Thank you for your purchase."}),x==="failure"&&e.jsx("div",{className:"payment-failure",children:"❌ Payment Failed! Please check your card details and try again."})]})};export{O as default};
