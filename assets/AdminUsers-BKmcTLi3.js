import{r as i,j as e}from"./index-v4Nki3aL.js";const w=()=>{const[m,c]=i.useState([]),[d,o]=i.useState(null),[l,p]=i.useState(null),n=localStorage.getItem("token");i.useEffect(()=>{const t=async()=>{try{const s=await fetch("http://localhost:8000/api/users/",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}}),a=await s.json();if(s.ok)c(a);else throw new Error(a.message||"Failed to fetch users")}catch(s){o(s.message)}},r=async()=>{try{const s=await fetch("http://localhost:8000/api/users/profile",{method:"GET",headers:{Authorization:`Bearer ${n}`}}),a=await s.json();if(s.ok)p(a);else throw new Error(a.message||"Failed to fetch current user")}catch(s){o(s.message)}};t(),r()},[]);const j=async t=>{try{const r=await fetch(`http://localhost:8000/api/users/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}});if(r.ok)c(s=>s.filter(a=>a._id!==t));else{const s=await r.json();throw new Error(s.message||"Failed to delete user")}}catch(r){o(r.message)}},f=t=>{if((l==null?void 0:l.username)!=="admin@123"){alert("You do not have permission to modify user roles. Please contact the super admin (admin@123).");return}const r=prompt(`Enter new role for ${t.firstName} ${t.lastName}:`);r&&u(t._id,r)},u=async(t,r)=>{try{const s=await fetch(`http://localhost:8000/api/users/${t}/role`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({role:r})});if(s.ok)c(a=>a.map(h=>h._id===t?{...h,role:r}:h));else{const a=await s.json();throw new Error(a.message||"Failed to update role")}}catch(s){o(s.message)}};return e.jsxs("div",{className:"admin-users",children:[e.jsx("h2",{children:"Manage Users"}),d&&e.jsx("div",{className:"error-message",children:d}),e.jsxs("div",{className:"user-list",children:[e.jsx("h3",{children:"User List"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:m.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{children:[t.firstName," ",t.lastName]}),e.jsx("td",{children:t.email}),e.jsx("td",{children:t.role}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>j(t._id),children:"Delete"}),e.jsx("button",{onClick:()=>f(t),children:"Modify Role"})]})]},t._id))})]})]})]})};export{w as default};
