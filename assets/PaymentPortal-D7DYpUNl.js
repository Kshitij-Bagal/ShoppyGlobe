import{k as P,u as E,d as D,r as m,l as F,j as e,m as k}from"./index-D3Q5HvY8.js";const T=()=>{const g=P(),{cart:h,total:p}=g.state||{cart:[],total:0},u=E(),c=D(r=>r.user.data),[x,y]=m.useState(null),[s,j]=m.useState({name:"",cardNumber:"1234567891011121",expiry:"12/24",cvv:"123",street:"",city:"",state:"",postalCode:""}),[a,N]=m.useState({name:!1,cardNumber:!1,expiry:!1,cvv:!1,street:!1,city:!1,state:!1,postalCode:!1});m.useEffect(()=>{c?j(r=>{var t,n,d,o;return{...r,street:((t=c.address)==null?void 0:t.street)||"",city:((n=c.address)==null?void 0:n.city)||"",state:((d=c.address)==null?void 0:d.state)||"",postalCode:((o=c.address)==null?void 0:o.postalCode)||""}}):u(F())},[u,c]);const C=async()=>{try{const r=await fetch("https://shoppyglobe-server.onrender.com/api/cart/clear",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});r.ok?u(k()):console.error("Failed to clear cart:",await r.json())}catch(r){console.error("Error clearing cart:",r)}},f=async(r,t,n,d)=>{try{const o={userId:r,cart:t.map(i=>({title:i.title,thumbnail:i.thumbnail,productId:i._id,quantity:i.quantity,price:i.price})),shippingAddress:n,total:d,paymentStatus:"success"},v=await fetch("https://shoppyglobe-server.onrender.com/api/orders",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(o)}),q=await v.json();v.status===201?await C():console.error("Error:",q)}catch(o){console.error("Error:",o)}},l=r=>{const{name:t,value:n}=r.target;j({...s,[t]:n})},b=()=>{const r={};return r.name=s.name.trim()==="",r.cardNumber=s.cardNumber.length!==16,r.expiry=!/\d{2}\/\d{2}/.test(s.expiry),r.cvv=s.cvv.length!==3,r.street=s.street.trim()==="",r.city=s.city.trim()==="",r.state=s.state.trim()==="",r.postalCode=s.postalCode.trim()==="",N(r),Object.values(r).some(t=>t)},S=r=>{if(r.preventDefault(),b())y("failure");else{y("success");const t={street:s.street,city:s.city,state:s.state,postalCode:s.postalCode};f(c._id,h,t,p)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"payment-portal",children:[e.jsxs("div",{className:"product-summary",children:[e.jsx("h2",{children:"Demo Payment Portal"}),e.jsx("h3",{children:"Order Summary"}),e.jsx("ul",{children:h.map(r=>e.jsxs("li",{children:[r.title," x ",r.quantity," - $",r.price*r.quantity]},r._id))}),e.jsxs("h4",{children:["Total: $",p.toFixed(2)]})]}),e.jsxs("form",{onSubmit:S,className:"payment-form",children:[e.jsx("h3",{children:"Payment Details"}),e.jsx("label",{children:"Name on Card"}),e.jsx("input",{type:"text",name:"name",placeholder:"John Doe",required:!0,onChange:l,className:a.name?"error":""}),a.name&&e.jsx("small",{className:"error-message",children:"Name is required"}),e.jsx("label",{children:"Card Number"}),e.jsx("input",{type:"text",name:"cardNumber",placeholder:"1234567891011121",maxLength:"16",required:!0,onChange:l,className:a.cardNumber?"error":"",value:s.cardNumber}),a.cardNumber&&e.jsx("small",{className:"error-message",children:"Card number must be 16 digits"}),e.jsxs("div",{className:"card-info",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Expiry Date"}),e.jsx("br",{}),e.jsx("input",{type:"text",name:"expiry",placeholder:"MM/YY",maxLength:"5",required:!0,onChange:l,className:a.expiry?"error":"",value:s.expiry}),a.expiry&&e.jsx("small",{className:"error-message",children:"Invalid expiry format"})]}),e.jsxs("div",{children:[e.jsx("label",{children:"CVV"}),e.jsx("br",{}),e.jsx("input",{type:"text",id:"cvv",name:"cvv",placeholder:"123",maxLength:"3",required:!0,onChange:l,className:a.cvv?"error":"",value:s.cvv}),a.cvv&&e.jsx("small",{className:"error-message",children:"CVV must be 3 digits"})]})]}),e.jsxs("div",{className:"address",children:[e.jsx("h3",{children:"Shipping Address"}),e.jsx("label",{children:"Street"}),e.jsx("input",{type:"text",name:"street",value:s.street,onChange:l,required:!0,className:a.street?"error":""}),a.street&&e.jsx("small",{className:"error-message",children:"Street is required"}),e.jsx("label",{children:"City"}),e.jsx("input",{type:"text",name:"city",value:s.city,onChange:l,required:!0,className:a.city?"error":""}),a.city&&e.jsx("small",{className:"error-message",children:"City is required"}),e.jsx("label",{children:"State"}),e.jsx("input",{type:"text",name:"state",value:s.state,onChange:l,required:!0,className:a.state?"error":""}),a.state&&e.jsx("small",{className:"error-message",children:"State is required"}),e.jsx("label",{children:"Postal Code"}),e.jsx("input",{type:"text",name:"postalCode",value:s.postalCode,onChange:l,required:!0,className:a.postalCode?"error":""}),a.postalCode&&e.jsx("small",{className:"error-message",children:"Postal code is required"})]}),e.jsx("button",{type:"submit",children:"Pay Now"})]})]}),e.jsxs("div",{className:"payment-status",children:[x==="success"&&e.jsx("div",{className:"success",children:e.jsx("p",{children:". ✅ Payment Successful! Thank you for your purchase."})}),x==="failure"&&e.jsx("div",{className:"failure",children:e.jsx("p",{children:"❌ Payment Failed! Please check your card details and try again."})})]})]})};export{T as default};
