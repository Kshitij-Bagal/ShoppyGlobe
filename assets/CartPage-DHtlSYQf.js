import{u as j,r as i,j as t,f as y,h as f,d as p,L as m,i as g}from"./index-Duvofgoi.js";const v=({item:e})=>{const a=j(),[r,s]=i.useState(!1),[l,o]=i.useState(e.quantity),[c,d]=i.useState(null),n=async x=>{const h=l+x;if(!(h<1)){s(!0);try{o(h),await a(y({id:e.productId,quantity:h}))}catch{d("Failed to update quantity. Please try again."),o(e.quantity)}finally{s(!1)}}},u=async()=>{s(!0);try{await a(f(e.productId))}catch{d("Failed to remove item. Please try again.")}finally{s(!1)}};return e.thumbnail,t.jsxs("div",{className:"cart-item",children:[t.jsxs("div",{className:"cart-item-details",children:[t.jsx("img",{className:"cart-item-image",src:e.thumbnail,alt:e.title}),t.jsxs("div",{children:[t.jsx("h3",{children:e.title}),t.jsxs("p",{children:["Price: $",e.price]}),t.jsxs("div",{className:"cart-item-quantity",children:[t.jsx("label",{htmlFor:`quantity-${e.productId}`,children:"Quantity:"}),t.jsxs("div",{className:"quantity-controls",children:[t.jsx("button",{onClick:()=>n(-1),disabled:r||l<=1,children:"-"}),t.jsx("span",{children:l}),t.jsx("button",{onClick:()=>n(1),disabled:r,children:"+"})]}),c&&t.jsx("span",{id:`quantity-error-${e.productId}`,className:"error-message",children:c})]})]})]}),t.jsx("div",{className:"cart-item-actions",children:t.jsx("button",{onClick:u,disabled:r,"aria-label":`Remove ${e.title} from cart`,children:r?"Removing...":"Remove"})})]})},C=()=>{const e=p(a=>a.cart.items);return t.jsxs("div",{className:"cart",children:[t.jsx("h2",{children:"Your Cart"}),e.length===0?t.jsxs("p",{children:["Your cart is empty. ",t.jsx(m,{to:"/products",children:"Shop now!"})]}):t.jsx("div",{className:"cart-items",children:e.map(a=>t.jsx(v,{item:a},a.productId||a.id))})]})},k=()=>{const e=j(),a=p(n=>n.cart.items||[]),[r,s]=i.useState(!0),[l,o]=i.useState(!1),c=localStorage.getItem("token");i.useEffect(()=>{c&&(async()=>{if(!c){alert("Please log in to access your cart"),s(!1);return}if(c)try{s(!0),await e(g())}catch(u){console.error("Failed to fetch cart:",u)}finally{s(!1)}})()},[e,c]);const d=async()=>{try{o(!0)}catch(n){console.error("Order placement failed:",n)}};return r?t.jsx("div",{children:"Loading..."}):t.jsx("div",{className:"app-container",children:t.jsxs("div",{className:"cart-page",children:[t.jsx("h2",{children:"Your Shopping Cart"}),a.length===0?t.jsxs("div",{className:"empty-cart",children:[t.jsx("p",{children:"Your cart is empty!"}),t.jsx(m,{to:"/browse",children:"Browse Products"})]}):t.jsxs(t.Fragment,{children:[t.jsx(C,{cartItems:a}),t.jsxs("div",{className:"cart-summary",children:[t.jsxs("h3",{children:["Total: $",N(a).toFixed(2)]}),t.jsx(m,{to:"/checkout",className:"checkout-btn",children:t.jsx("button",{onClick:d,className:"checkout-btn",children:l?"Order Placed":"Place Order"})})]})]})]})})},N=e=>e.reduce((a,r)=>a+r.price*r.quantity,0);export{k as default};
