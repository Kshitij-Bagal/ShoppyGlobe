import{l as q,u as P,d as D,r as m,m as E,j as e,k as F}from"./index-DSnHb9Ce.js";const k=()=>{const N=q(),{cart:p,total:h}=N.state||{cart:[],total:0},u=P(),n=D(s=>s.user.data),[x,y]=m.useState(null),[t,j]=m.useState({name:"",cardNumber:"1234567891011121",expiry:"12/24",cvv:"123",street:"",city:"",state:"",postalCode:""}),[a,g]=m.useState({name:!1,cardNumber:!1,expiry:!1,cvv:!1,street:!1,city:!1,state:!1,postalCode:!1});m.useEffect(()=>{n?j(s=>{var r,c,d,i;return{...s,street:((r=n.address)==null?void 0:r.street)||"",city:((c=n.address)==null?void 0:c.city)||"",state:((d=n.address)==null?void 0:d.state)||"",postalCode:((i=n.address)==null?void 0:i.postalCode)||""}}):u(E())},[u,n]);const C=async(s,r,c,d)=>{try{const i={userId:s,cart:r.map(o=>({title:o.title,thumbnail:o.thumbnail,productId:o._id,quantity:o.quantity,price:o.price})),shippingAddress:c,total:d,paymentStatus:"success"},v=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(i)}),S=await v.json();v.status===201?u(F()):console.error("Error:",S)}catch(i){console.error("Error:",i)}},l=s=>{const{name:r,value:c}=s.target;j({...t,[r]:c})},f=()=>{const s={};return s.name=t.name.trim()==="",s.cardNumber=t.cardNumber.length!==16,s.expiry=!/\d{2}\/\d{2}/.test(t.expiry),s.cvv=t.cvv.length!==3,s.street=t.street.trim()==="",s.city=t.city.trim()==="",s.state=t.state.trim()==="",s.postalCode=t.postalCode.trim()==="",g(s),Object.values(s).some(r=>r)},b=s=>{if(s.preventDefault(),f())y("failure");else{y("success");const r={street:t.street,city:t.city,state:t.state,postalCode:t.postalCode};C(n._id,p,r,h)}};return e.jsxs("div",{className:"payment-portal",children:[e.jsxs("div",{className:"product-summary",children:[e.jsx("h2",{children:"Demo Payment Portal"}),e.jsx("h3",{children:"Order Summary"}),e.jsx("ul",{children:p.map(s=>e.jsxs("li",{children:[s.title," x ",s.quantity," - $",s.price*s.quantity]},s._id))}),e.jsxs("h4",{children:["Total: $",h.toFixed(2)]})]}),e.jsxs("form",{onSubmit:b,className:"payment-form",children:[e.jsx("h3",{children:"Payment Details"}),e.jsx("label",{children:"Name on Card"}),e.jsx("input",{type:"text",name:"name",placeholder:"John Doe",required:!0,onChange:l,className:a.name?"error":""}),a.name&&e.jsx("small",{className:"error-message",children:"Name is required"}),e.jsx("label",{children:"Card Number"}),e.jsx("input",{type:"text",name:"cardNumber",placeholder:"1234567891011121",maxLength:"16",required:!0,onChange:l,className:a.cardNumber?"error":"",value:t.cardNumber}),a.cardNumber&&e.jsx("small",{className:"error-message",children:"Card number must be 16 digits"}),e.jsxs("div",{className:"card-info",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Expiry Date"}),e.jsx("br",{}),e.jsx("input",{type:"text",name:"expiry",placeholder:"MM/YY",maxLength:"5",required:!0,onChange:l,className:a.expiry?"error":"",value:t.expiry}),a.expiry&&e.jsx("small",{className:"error-message",children:"Invalid expiry format"})]}),e.jsxs("div",{children:[e.jsx("label",{children:"CVV"}),e.jsx("br",{}),e.jsx("input",{type:"text",name:"cvv",placeholder:"123",maxLength:"3",required:!0,onChange:l,className:a.cvv?"error":"",value:t.cvv}),a.cvv&&e.jsx("small",{className:"error-message",children:"CVV must be 3 digits"})]})]}),e.jsx("h3",{children:"Shipping Address"}),e.jsx("label",{children:"Street"}),e.jsx("input",{type:"text",name:"street",value:t.street,onChange:l,required:!0,className:a.street?"error":""}),a.street&&e.jsx("small",{className:"error-message",children:"Street is required"}),e.jsx("label",{children:"City"}),e.jsx("input",{type:"text",name:"city",value:t.city,onChange:l,required:!0,className:a.city?"error":""}),a.city&&e.jsx("small",{className:"error-message",children:"City is required"}),e.jsx("label",{children:"State"}),e.jsx("input",{type:"text",name:"state",value:t.state,onChange:l,required:!0,className:a.state?"error":""}),a.state&&e.jsx("small",{className:"error-message",children:"State is required"}),e.jsx("label",{children:"Postal Code"}),e.jsx("input",{type:"text",name:"postalCode",value:t.postalCode,onChange:l,required:!0,className:a.postalCode?"error":""}),a.postalCode&&e.jsx("small",{className:"error-message",children:"Postal code is required"}),e.jsx("button",{type:"submit",children:"Pay Now"})]}),x==="success"&&e.jsx("div",{className:"payment-success",children:"✅ Payment Successful! Thank you for your purchase."}),x==="failure"&&e.jsx("div",{className:"payment-failure",children:"❌ Payment Failed! Please check your card details and try again."})]})};export{k as default};
