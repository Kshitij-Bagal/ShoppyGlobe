import{r as i,j as e}from"./index-BfvK3Jrr.js";const y=()=>{const[m,c]=i.useState([]),[h,a]=i.useState(null),[l,p]=i.useState(null),n=localStorage.getItem("token");i.useEffect(()=>{const s=async()=>{try{const t=await fetch("https://shoppyglobe-server.onrender.com/api/users/",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}}),o=await t.json();if(t.ok)c(o);else throw new Error(o.message||"Failed to fetch users")}catch(t){a(t.message)}},r=async()=>{try{const t=await fetch("https://shoppyglobe-server.onrender.com/api/users/profile",{method:"GET",headers:{Authorization:`Bearer ${n}`}}),o=await t.json();if(t.ok)p(o);else throw new Error(o.message||"Failed to fetch current user")}catch(t){a(t.message)}};s(),r()},[]);const j=async s=>{try{const r=await fetch(`https://shoppyglobe-server.onrender.com/api/users/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}});if(r.ok)c(t=>t.filter(o=>o._id!==s));else{const t=await r.json();throw new Error(t.message||"Failed to delete user")}}catch(r){a(r.message)}},f=s=>{if((l==null?void 0:l.username)!=="admin@123"){alert("You do not have permission to modify user roles. Please contact the super admin (admin@123).");return}const r=prompt(`Enter new role for ${s.firstName} ${s.lastName}:`);r&&u(s._id,r)},u=async(s,r)=>{try{const t=await fetch(`https://shoppyglobe-server.onrender.com/api/users/${s}/role`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({role:r})});if(t.ok)c(o=>o.map(d=>d._id===s?{...d,role:r}:d));else{const o=await t.json();throw new Error(o.message||"Failed to update role")}}catch(t){a(t.message)}};return e.jsxs("div",{className:"admin-users",children:[e.jsx("h2",{children:"Manage Users"}),h&&e.jsx("div",{className:"error-message",children:h}),e.jsxs("div",{className:"user-list",children:[e.jsx("h3",{children:"User List"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:m.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:[s.firstName," ",s.lastName]}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.role}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>j(s._id),children:"Delete"}),e.jsx("button",{onClick:()=>f(s),children:"Modify Role"})]})]},s._id))})]})]})]})};export{y as default};
